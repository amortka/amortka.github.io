{"version":3,"sources":["components/CursorParallax/CursorParallax.module.css","components/SceneContainer/SceneContainer.module.css","components/Frame/Frame.module.css","classes/CameraControls.class.js","classes/Mercator.class.js","config.js","utilities/geo.utilities.js","classes/SceneService.js","classes/SceneManager.class.js","classes/CSVLayer.class.js","classes/GeoJsonLayer.class.js","components/SceneContainer/SceneContainer.js","components/Frame/Frame.js","components/Scrollr/Scrollr.js","components/CursorParallax/CursorParallax.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","cursor","active","wrapper","canvas","Frame","instance","CameraControls","camera","nodeEl","enabled","arguments","length","undefined","Object","classCallCheck","this","controls","OrbitControls","enableDamping","dampingFactor","rotateSpeed","autoRotateSpeed","minPolarAngle","maxPolarAngle","Math","PI","update","EARTH_RADIUS","POINT_WROCLAW_CENTER","deg2rad","deg","rad2deg","rad","Mercator","center","factor","lon","Array","isArray","lat","latInRadians","k","radius","inLon","inLat","b","sin","cos","x","log","y","atan","tan","px","py","D","sinh","asin","cosh","classes_SceneService","SceneService","sceneSwitch$","Subject","sceneProgress$","sceneLerp$","animatePause$","BehaviorSubject","animateProgress$","radius$","Vector3","SceneManager","canvasEl","console","dimensions","width","height","layers","init","destroyed","c","window","cancelAnimationFrame","raf","document","removeEventListener","onKeyDown","forEach","l","destroy","initScene","initRenderer","initCamera","initMercator","initHelpers","initControls","initEvents","loop","_this","render","requestAnimationFrame","scene","Scene","layersGroup","Group","name","add","AxesHelper","gridHelper","GridHelper","position","setY","material","blending","AdditiveBlending","opacity","transparent","geometry","OctahedronGeometry","MeshNormalMaterial","cameraPositionHelper","Mesh","renderer","WebGLRenderer","alpha","antialias","setClearColor","shadowMap","soft","setPixelRatio","devicePixelRatio","setSize","innerWidth","innerHeight","lerpEnabled","cameraTargetPosition","aspectRatio","PerspectiveCamera","set","_this2","cameraTarget","cameraPosition","cameraControls","loadCameraFromLS","cameraMove$","fromEvent","passive","pipe","map","mouseEvent","clientX","clientY","subscribe","_ref","angleX","z","_this3","bind","addEventListener","state","mercator","JSON","parse","localStorage","getItem","concat","target","copy","object","zoom","setItem","stringify","e","keyCode","saveControlsLS","lookAt","lerp","layer","push","group","traverse","child","visible","direction","setOpacity","CSVLayer","data","options","columns","objectSpread","createObjects","colors","color","Color","scale","scaleThreshold","domain","range","BufferGeometry","vertices","degree","Float32Array","displacement","v3Colors","point","idx","_this$mercator$fromGe","fromGeo","parseFloat","X","Y","value","d","r","random","g","addAttribute","Float32BufferAttribute","BufferAttribute","uniforms","u_hexSize","type","u_angle","ShaderMaterial","vertexShader","fragmentShader","mesh","LineSegments","mouseMove$","merge","switchMap","paused","empty","ev","pageX","scrollX","pageY","scrollY","max","filter","inner","next","o","tl","TimelineMax","repeat","repeatDelay","yoyo","onUpdate","t","progress","to","ease","Power2","easeInOut","timeEnd","pause","resume","MeshBasicMaterial","side","DoubleSide","GeoJsonLayer","geojson","featureEach","feature","id","createMesh","Geometry","polygons","getType","getCoords","coords","polygonId","polyCentroid","getCoord","centroid","polygon","centerPoint","fill","shape","Shape","points","startPoint","shift","moveTo","p","lineTo","ExtrudeGeometry","amount","bevelEnabled","bevelSegments","steps","bevelSize","bevelThickness","properties","rotation","pairs","a","LineBasicMaterial","pos","_scale","TweenLite","delay","SteppedEase","config","meshDuplicate","clone","setHex","SceneContainer","_Component","_getPrototypeOf2","_len","args","_key","possibleConstructorReturn","getPrototypeOf","call","apply","canvasRef","React","createRef","inherits","createClass","key","sceneManager","current","initLayers","axios","get","process","then","response","boundslayer","addLayer","centroidsLayer","react_default","createElement","className","styles","ref","Component","paths","frameSize","POSITION","Scrollr","props","refEl","scrollableParent","subscriptions","handleScroll","assertThisInitialized","renderArgs","subscription","unsubscribe","getScrollableParent","scroll$","event","bounds","getBounds","previousPosition","currentPosition","getPosition","cbArgs","topOffsetPx","pointEnd","viewportBottom","viewportTop","pTop","min","waypointTop","pBottom","waypointBottom","onProgress","setState","onEnter","onLeave","contextHeight","contextScrollTop","parentElement","horizontal","_parentElement$getBou","getBoundingClientRect","left","top","right","bottom","offsetWidth","offsetHeight","_this$props","bottomOffset","computeOffsetPixels","topOffset","node","parentNode","body","style","getComputedStyle","overflow","getPropertyValue","_this$props2","children","cloneElement","isElement","offset","pixelOffset","str","isNaN","isFinite","slice","parseOffsetAsPixels","percentOffset","parseOffsetAsPercentage","defaultProps","horizontalll","displayName","App","enabledScene","enabledFrame","enabledAnimate","enabledLerp","toggle","handleWaypointEnter","handleWaypointLeave","handleWaypointProgress","pauseResume","animateSetProgress","animateSetRadius","propname","defineProperty","_ref2","es_button","onClick","es_switch","defaultChecked","checkedChildren","unCheckedChildren","onChange","checked","slider","step","SceneContainer_SceneContainer","Boolean","location","hostname","match","ReactDOM","src_App_0","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.dd5f3e1a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"cursor\":\"CursorParallax_cursor__14cNF\",\"active\":\"CursorParallax_active__3J2um\",\"wrapper\":\"CursorParallax_wrapper__Rq-RK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"SceneContainer_canvas__2pnsa\",\"wrapper\":\"SceneContainer_wrapper__3kzlN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Frame\":\"Frame_Frame__Z95oO\"};","import OrbitControls from 'orbit-controls-es6';\r\n\r\nlet instance;\r\nclass CameraControls {\r\n  constructor(camera, nodeEl, enabled = true) {\r\n    if (instance) {\r\n      return instance;\r\n    }\r\n\r\n    this.controls = new OrbitControls(camera, nodeEl);\r\n    this.controls.enabled = enabled;\r\n    this.controls.enableDamping = true;\r\n    this.controls.dampingFactor = 0.1;\r\n    this.controls.rotateSpeed = 0.2;\r\n    // this.controls.autoRotate = true;\r\n    this.controls.autoRotateSpeed = 0.1;\r\n    // this.controls.enableZoom = false;\r\n\r\n    this.controls.minPolarAngle = 0; // radians\r\n    this.controls.maxPolarAngle = Math.PI / 2 - 0 * (Math.PI / 180); // radians\r\n\r\n    instance = this;\r\n  }\r\n\r\n  enable() {\r\n    this.controls.enabled = true;\r\n  }\r\n\r\n  disable() {\r\n    this.controls.enabled = false;\r\n  }\r\n\r\n  update() {\r\n    this.controls.update();\r\n  }\r\n}\r\n\r\nexport default CameraControls;\r\n","import { EARTH_RADIUS } from '../config';\r\nimport { deg2rad, rad2deg } from '../utilities';\r\n\r\nlet instance;\r\n\r\nclass Mercator {\r\n  constructor(center, factor = 1) {\r\n    if (instance) {\r\n      return instance;\r\n    }\r\n\r\n    this.lon = Array.isArray(center) ? center[0] : center.lon;\r\n    this.lat = Array.isArray(center) ? center[1] : center.lat;\r\n\r\n    this.latInRadians = deg2rad(this.lat);\r\n    this.k =  factor;\r\n    this.radius = EARTH_RADIUS;\r\n\r\n    instance = this;\r\n  }\r\n\r\n  fromGeo(inLon, inLat) {\r\n    const lat = deg2rad(inLat);\r\n    const lon = deg2rad(inLon - this.lon);\r\n    const b = Math.sin(lon) * Math.cos(lat);\r\n    const x = 0.5 * this.k * this.radius * Math.log((1 + b) / (1 - b));\r\n    const y =\r\n      -this.k *\r\n      this.radius *\r\n      (Math.atan(Math.tan(lat) / Math.cos(lon)) - this.latInRadians);\r\n\r\n    return {\r\n      x,\r\n      y,\r\n    };\r\n  };\r\n\r\n  fromXY(px, py) {\r\n    const x = px / (this.k * this.radius);\r\n    const y = py / (this.k * this.radius);\r\n    const D = y + this.latInRadians;\r\n\r\n    let lon = Math.atan(Math.sinh(x) / Math.cos(D));\r\n    let lat = Math.asin(Math.sin(D) / Math.cosh(x));\r\n\r\n    lon = this.lon + rad2deg(lon);\r\n    lat = rad2deg(lat);\r\n\r\n    return { lat, lon };\r\n  };\r\n\r\n\r\n}\r\n\r\nexport default Mercator;\r\n\r\n","// Lat = Y Long = X\r\n// wroclaw\r\n// lat: 51.107883\r\n// lon: 17.038538\r\n\r\n// bbox = left, bottom, right, top\r\n// bbox = min Longitude , min Latitude , max Longitude , max Latitude\r\n// box =  minX, minY, maxX, maxY\r\n\r\nexport const PI = 3.14159;\r\n\r\nexport const PI_HALF = 1.5707963;\r\n\r\nexport const EARTH_RADIUS = 6378137;\r\n\r\nexport const BBOX_WROCLAW = [\r\n  16.80552829,\r\n  51.040649965,\r\n  17.177328263,\r\n  51.212286538\r\n];\r\n\r\nexport const POINT_WROCLAW_CENTER = [17.038538, 51.107883];\r\n\r\nexport const ZOOM_TILES = 13;\r\n\r\nexport const URL_PROXY = 'http://localhost:8080/';\r\n\r\nexport const TILE_URL_OSM = (x, y, z) =>\r\n  `${URL_PROXY}https://a.tile.openstreetmap.org/${z}/${x}/${y}.png`;\r\n\r\nexport const TILE_URL_LOCAL = (x, y, z) =>\r\n  `${URL_PROXY}http://localhost:1337/${z}/${x}/${y}.png`;\r\n\r\nexport const TILE_URL_CARTO_DARK = (x, y, z) =>\r\n  `${URL_PROXY}https://a.basemaps.cartocdn.com/dark_all/${z}/${x}/${y}.png`;\r\n\r\nexport const TILE_URL_ESRI = (x, y, z) =>\r\n  `${URL_PROXY}https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/${z}/${y}/${x}`;\r\n\r\nexport const TILE_URL_ORTO_2018 = (x, y, z) =>\r\n  `${process.env.PUBLIC_URL}/assets/tiles/${z}/${x}/${y}.png`;\r\n","const PI = 3.14159;\r\n// const PI_HALF = 1.5707963;\r\n\r\nexport const deg2rad = deg => {\r\n  return (deg * PI) / 180;\r\n};\r\n\r\nexport const rad2deg = rad => {\r\n  return (rad * 180) / PI;\r\n};\r\n\r\nexport const lon2tile = (lon, zoom) =>\r\n  Math.floor(((lon + 180) / 360) * Math.pow(2, zoom));\r\n\r\nexport const lat2tile = (lat, zoom) =>\r\n  Math.floor(\r\n    ((1 -\r\n      Math.log(\r\n        Math.tan((lat * Math.PI) / 180) + 1 / Math.cos((lat * Math.PI) / 180)\r\n      ) /\r\n        Math.PI) /\r\n      2) *\r\n      Math.pow(2, zoom)\r\n  );\r\n\r\n// Lat = Y Long = X\r\nexport const lonlat2XY = (lon, lat, zoom) => {\r\n  return [lon2tile(lon, zoom), lat2tile(lat, zoom), zoom];\r\n};\r\n\r\nexport const getTilesFromBbox = (bbox, zoom, offset = 0) => {\r\n  // T1 = LEFT TOP\r\n  //      min lon, max lat\r\n  // T2 = RIGHT BOTTOM\r\n  //      max lon, min lat\r\n\r\n  const t1 = lonlat2XY(bbox[0], bbox[3], zoom);\r\n  const t2 = lonlat2XY(bbox[2], bbox[1], zoom);\r\n\r\n  if (offset) {\r\n    t1[0] = t1[0] - offset;\r\n    t1[1] = t1[1] - offset;\r\n    t2[0] = t2[0] + offset;\r\n    t2[1] = t2[1] + offset;\r\n  }\r\n\r\n  console.log({ offset });\r\n  console.log(t1);\r\n  console.log(t2);\r\n\r\n  const tX = Math.abs(t1[0] - t2[0]) + 1;\r\n  const tY = Math.abs(t1[1] - t2[1]) + 1;\r\n  const tc = [Math.abs(t1[0] + t2[0]) / 2, Math.abs(t1[1] + t2[1]) / 2];\r\n\r\n  const tiles = [];\r\n  for (let ix = 0; ix < tX; ix++) {\r\n    for (let iy = 0; iy < tY; iy++) {\r\n      const x = t1[0] + ix;\r\n      const y = t1[1] + iy;\r\n      const z = zoom;\r\n\r\n      const tile = [x, y, z];\r\n\r\n      tiles.push(tile);\r\n    }\r\n  }\r\n\r\n  // sort from center\r\n  tiles.sort((ta, tb) => {\r\n    return (\r\n      Math.hypot(ta[0] - tc[0], ta[1] - tc[1]) -\r\n      Math.hypot(tb[0] - tc[0], tb[1] - tc[1])\r\n    );\r\n  });\r\n\r\n  return tiles;\r\n};\r\n\r\nexport const getTileSize = (lon, lat, zoom, mercator) => {\r\n  const tile = lonlat2XY(lon, lat, zoom);\r\n\r\n  const coordsNW = tile2geo(tile[0], tile[1], zoom);\r\n  const coordsSE = tile2geo(tile[0] + 1, tile[1] + 1, zoom);\r\n\r\n  const posNW = mercator.fromGeo(coordsNW.lon, coordsNW.lat);\r\n  const posSE = mercator.fromGeo(coordsSE.lon, coordsSE.lat);\r\n\r\n  return Math.ceil(Math.abs(posNW.x - posSE.x));\r\n};\r\n\r\nexport const tile2geo = (x, y, z) => {\r\n  const n = Math.PI - (2 * Math.PI * y) / Math.pow(2, z);\r\n  const lat = (180 / Math.PI) * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\r\n  const lon = (x / Math.pow(2, z)) * 360 - 180;\r\n\r\n  return {\r\n    lon,\r\n    lat\r\n  };\r\n};\r\n","import { Subject, BehaviorSubject } from 'rxjs';\r\n\r\nclass SceneService {\r\n\r\n  constructor() {\r\n    this.sceneSwitch$ = new Subject();\r\n    this.sceneProgress$ = new Subject();\r\n    this.sceneLerp$ = new Subject();\r\n    \r\n    this.animatePause$ = new BehaviorSubject(false);\r\n    this.animateProgress$ = new Subject();\r\n    this.radius$ = new Subject();\r\n  }\r\n\r\n}\r\n\r\n\r\nexport default new SceneService();","import {\r\n  AdditiveBlending,\r\n  AxesHelper,\r\n  GridHelper,\r\n  Mesh,\r\n  Group,\r\n  Scene,\r\n  WebGLRenderer,\r\n  // OrthographicCamera,\r\n  PerspectiveCamera,\r\n  Vector3,\r\n  OctahedronGeometry,\r\n  MeshNormalMaterial\r\n} from 'three';\r\nimport CameraControls from './CameraControls.class';\r\nimport Mercator from './Mercator.class';\r\nimport { POINT_WROCLAW_CENTER, PI_HALF } from '../config';\r\nimport { fromEvent } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { deg2rad } from '../utilities';\r\nimport SceneService from './SceneService';\r\n\r\nconst nearPlane = 10;\r\nconst farPlane = 50000;\r\nconst fieldOfView = 20;\r\nconst LS_PREFIX = 'wroclovedata_';\r\n\r\nconst center = new Vector3(0, 0, 0);\r\nconst cameraRadius = 2500;\r\n\r\nclass SceneManager {\r\n  constructor(canvasEl) {\r\n    console.log('SceneManager()');\r\n    this.canvas = canvasEl;\r\n    this.dimensions = {\r\n      width: canvasEl.width,\r\n      height: canvasEl.height\r\n    };\r\n\r\n    this.layers = [];\r\n\r\n    this.init();\r\n    this.destroyed = false;\r\n  }\r\n\r\n  destroy() {\r\n    console.log('destroy:', this.c);\r\n    this.destroyed = true;\r\n    window.cancelAnimationFrame(this.raf);\r\n\r\n    document.removeEventListener('keydown', this.onKeyDown, false);\r\n    this.layers.forEach(l => l.destroy());\r\n  }\r\n\r\n  init() {\r\n    this.initScene();\r\n    this.initRenderer();\r\n    this.initCamera();\r\n\r\n    this.initMercator();\r\n    this.initHelpers();\r\n    this.initControls();\r\n    this.initEvents();\r\n\r\n    this.loop();\r\n  }\r\n\r\n  loop() {\r\n    if (!this.destroyed) {\r\n      this.update();\r\n      this.render();\r\n      this.raf = window.requestAnimationFrame(() => this.loop());\r\n    }\r\n  }\r\n\r\n  initScene() {\r\n    this.scene = new Scene();\r\n    this.layersGroup = new Group();\r\n    this.layersGroup.name = 'main_group';\r\n\r\n    this.scene.add(this.layersGroup);\r\n    \r\n  }\r\n\r\n  initHelpers() {\r\n    const axisHelper = new AxesHelper(1000);\r\n    const gridHelper = new GridHelper(100000, 1000, 0x1abc9c, 0x1abc9c);\r\n    gridHelper.position.setY(0);\r\n    gridHelper.material.blending = AdditiveBlending;\r\n    gridHelper.material.opacity = 0.1;\r\n    gridHelper.material.transparent = true;\r\n\r\n    // this.scene.add(axisHelper);\r\n    this.scene.add(gridHelper);\r\n\r\n\r\n    const geometry = new OctahedronGeometry(10);\r\n    const material = new MeshNormalMaterial();\r\n\r\n    this.cameraPositionHelper = new Mesh(geometry, material);\r\n    // this.scene.add(this.cameraPositionHelper);\r\n\r\n  }\r\n\r\n  initRenderer() {\r\n    const renderer = new WebGLRenderer({\r\n      canvas: this.canvas,\r\n      alpha: true,\r\n      antialias: false,\r\n      opacity: 0.8,\r\n      blending: AdditiveBlending\r\n    });\r\n    renderer.setClearColor(0xffffff, 0);\r\n\r\n    renderer.shadowMap.soft = false;\r\n    renderer.shadowMap.enabled = true;\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n    this.renderer = renderer;\r\n  }\r\n\r\n  initCamera() {\r\n    this.lerpEnabled = true;\r\n    this.cameraTargetPosition = new Vector3(0, 3000, 0);\r\n    const aspectRatio = this.canvas.width / this.canvas.height;\r\n    // const DPR = window.devicePixelRatio || 1;\r\n\r\n    this.camera = new PerspectiveCamera(\r\n      fieldOfView,\r\n      aspectRatio,\r\n      nearPlane,\r\n      farPlane\r\n    );\r\n\r\n    // this.camera = new OrthographicCamera(\r\n    // this.canvas.width / - 2, this.canvas.width / 2, this.canvas.height / 2, this.canvas.height / - 2, nearPlane, farPlane\r\n    // );\r\n\r\n    // this.cameraTarget = new Vector3(0, 0, 0);\r\n// \r\n    this.camera.position.set(100, 100, 50);\r\n    // this.camera.lookAt(this.cameraTarget);d\r\n  }\r\n\r\n  initControls() {\r\n    this.cameraTarget = new Vector3(0, 0, 0);\r\n    this.camera.position.set(674.4484878333734, 699.3695242813109, 1679.9599093246045);\r\n    this.cameraPosition = new Vector3(674.4484878333734, 699.3695242813109, 1679.9599093246045);\r\n\r\n    this.cameraControls = new CameraControls(this.camera, this.canvas);\r\n    this.loadCameraFromLS();\r\n    \r\n    this.cameraControls.update();\r\n\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n\r\n    this.cameraMove$ = fromEvent(window, 'mousemove', { passive: true});\r\n    this.cameraMove$\r\n    .pipe(map( mouseEvent => {\r\n      const { clientX, clientY} = mouseEvent;\r\n      \r\n      const x = -1 + (clientX / width) * 2;\r\n      const y = -1 + (clientY / height) * 2;\r\n\r\n      return {x, y};\r\n    }))\r\n    .subscribe(({x, y}) => {\r\n      // this.camera.rotation.y = x * PI_HALF;\r\n      const angleX = deg2rad(x * 30);\r\n      const height = 2500 - (1500 * y);\r\n\r\n      // console.log('angleX:', angleX);\r\n\r\n      this.cameraPosition.x = cameraRadius * Math.sin(angleX);\r\n      this.cameraPosition.z = cameraRadius * Math.cos(angleX);\r\n      this.cameraPosition.y = height;\r\n\r\n\r\n      // console.log('x:', cameraRadius * Math.sin(angleX))\r\n      // console.log('z:', cameraRadius * Math.cos(angleX))\r\n\r\n      /*const newPoint = this.cameraTargetPosition.clone();\r\n\r\n      this.cameraTargetPosition.copy(newPoint);*/\r\n    })\r\n\r\n  }\r\n\r\n  initEvents() {\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    document.addEventListener('keydown', this.onKeyDown, false);\r\n\r\n    SceneService.sceneLerp$.subscribe(state => {\r\n      this.lerpEnabled = state;\r\n    })\r\n  }\r\n\r\n  initMercator() {\r\n    this.mercator = new Mercator(POINT_WROCLAW_CENTER, 0.1);\r\n  }\r\n\r\n  loadCameraFromLS() {\r\n    const controls = JSON.parse(localStorage.getItem(`${LS_PREFIX}_controls`));\r\n\r\n    if (controls && this.cameraControls) {\r\n      this.cameraControls.controls.target.copy(controls.target);\r\n      this.cameraControls.controls.object.position.copy(controls.position);\r\n      this.cameraControls.controls.object.zoom = controls.zoom;\r\n    }\r\n  }\r\n\r\n  saveControlsLS() {\r\n    const controls = {\r\n      target: this.cameraControls.controls.target,\r\n      position: this.cameraControls.controls.object.position,\r\n      zoom: this.cameraControls.controls.object.zoom\r\n    };\r\n\r\n    console.log('controls', { controls });\r\n    localStorage.setItem(`${LS_PREFIX}_controls`, JSON.stringify(controls));\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    switch (e.keyCode) {\r\n      case 83: {\r\n        // key: s\r\n        this.saveControlsLS();\r\n\r\n        break;\r\n      }\r\n      case 68: {\r\n        // key: d\r\n        console.log('LOAD camera from LS <==');\r\n        this.loadCameraFromLS();\r\n        break;\r\n      }\r\n      case 87: {\r\n        // this.makeScreenshot();\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.renderer.render(this.scene, this.camera);\r\n  }\r\n\r\n  update() {\r\n    this.cameraControls.update();\r\n\r\n    if (this.lerpEnabled) {\r\n      this.camera.lookAt(center);\r\n      this.camera.position.lerp( this.cameraPosition, 0.005);\r\n    }\r\n    // this.cameraPositionHelper.position.lerp(this.cameraPosition, 0.005);\r\n    // this.cameraPositionHelper.position.copy(this.cameraPosition);\r\n\r\n    this.layers.forEach(l => l.update());\r\n  }\r\n\r\n  addLayer(layer) {\r\n    this.layers.push(layer);\r\n\r\n    layer.init(this.layersGroup);\r\n    \r\n    // this.setLayerVisibility(layer, false);\r\n  }\r\n\r\n  setLayerVisibility(layer, state) {\r\n    layer.group.traverse(child => {\r\n      if (child instanceof Mesh) {\r\n        child.visible = state;\r\n      }\r\n    });\r\n  }\r\n\r\n  setLayerOpacity(layer, opacity, direction) {\r\n    layer.setOpacity(opacity, direction);\r\n  }\r\n}\r\n\r\nexport default SceneManager;\r\n","import {\r\n  Float32BufferAttribute,\r\n  BufferAttribute,\r\n  BufferGeometry,\r\n  Color,\r\n  AdditiveBlending,\r\n  Group,\r\n  Geometry,\r\n  LineBasicMaterial,\r\n  Line,\r\n  LineSegments,\r\n  ExtrudeGeometry,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  ShaderMaterial,\r\n  // MeshNormalMaterial,\r\n  // OctahedronGeometry,\r\n  Shape,\r\n  Vector3\r\n} from 'three';\r\n// import { featureEach } from '@turf/meta';\r\n// import { centroid, getCoords, getType, polygon, getCoord } from '@turf/turf';\r\nimport {\r\n  TweenLite,\r\n  TweenMax,\r\n  Power2,\r\n  Bounce,\r\n  Elastic,\r\n  SteppedEase,\r\n  TimelineMax\r\n} from 'gsap/all';\r\nimport { scaleLinear, scaleThreshold, scaleQuantize } from 'd3-scale';\r\n\r\n// import { pairs } from 'd3';\r\nimport Mercator from './Mercator.class';\r\nimport { PI_HALF } from '../config';\r\nimport parse from 'csv-parse/lib/sync';\r\nimport { attribute } from 'postcss-selector-parser';\r\nimport { fromEvent, merge, empty } from 'rxjs';\r\nimport { map, switchMap, filter } from 'rxjs/operators';\r\nimport SceneService from './SceneService';\r\n\r\nconst PI = 3.14159; //26535897932384626433832795;\r\n\r\n// x y z\r\n// q r s\r\n\r\nconst vertexShader = `\r\nattribute float a_degree;\r\nattribute float a_displacement;\r\nattribute vec3 a_color;\r\n\r\nvarying vec3 color;\r\n\r\nuniform float u_hexSize;\r\nuniform float u_angle;\r\n\r\nvec2 hexToPixel(vec3 h) {\r\n  float x = u_hexSize * sqrt(3.0) * (h.x + h.y / 2.0) ;\r\n  float y = u_hexSize * 3.0 / 2.0 * h.y;\r\n  \r\n  return vec2(x, y);  \r\n}\r\n\r\nvec3 cubeRound(vec3 cube) {\r\n  float rX = floor(cube.x + 0.5);\r\n  float rY = floor(cube.y + 0.5);\r\n  float rZ = floor(cube.z + 0.5);\r\n\r\n  float xDiff = abs(rX - cube.x);\r\n  float yDiff = abs(rY - cube.y);\r\n  float zDiff = abs(rZ - cube.z);\r\n\r\n  if (xDiff > yDiff && xDiff > zDiff) {\r\n    rX = -rY - rZ;\r\n  } else if (yDiff > zDiff) {\r\n    rY = -rX - rZ;\r\n  } else {\r\n    rZ = -rX - rY;\r\n  }\r\n\r\n  return vec3(rX, rY, rZ);\r\n}\r\n\r\nvec3 pixelToHex(vec3 p) {\r\n  float q = (((p.x) * sqrt(3.0) / 3.0) / u_hexSize - ((p.z) / 3.0) / u_hexSize);\r\n  float r = (p.z) * 2.0 / 3.0 / u_hexSize;\r\n  \r\n  return vec3(q, r, -q - r);\r\n}\r\n\r\nvoid main() { \r\n  vec2 pos = hexToPixel(cubeRound(pixelToHex(position)));\r\n \r\n  float xx = pos.x;\r\n  float yy = position.y * 0.5;\r\n  float zz = pos.y;\r\n\r\n   float x = (1.0 - u_angle) * xx + \r\n     ((100.0 + 10.0 * a_displacement) * sin(a_degree * u_angle + xx/10.0 )) * u_angle;\r\n   float y = yy * (1.0 - u_angle);\r\n   float z = (1.0 - u_angle) * zz + \r\n     ((100.0 + 10.0 * a_displacement) * cos(a_degree * u_angle + zz/10.0 )) * u_angle;\r\n\r\n  color = a_color;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(vec3(x, y, z), 1.0);\r\n }\r\n`;\r\n\r\nconst fragmentShader = `\r\n//Just as vertex shader, fragment shader must in the end set this variable (gl_FragColor)\r\n//We set it to a pink color.\r\nuniform vec2 u_resolution;\r\nuniform float u_time;\r\n\r\nvarying vec3 color;\r\n\r\nvoid main() {\r\n  vec2 st = gl_FragCoord.xy / u_resolution.xy;\r\n\r\n  gl_FragColor = vec4( color, 0.2);\r\n  // gl_FragColor = vec4(1.0,  // R\r\n                    //  1.0,  // G\r\n                    //  1.0,  // B\r\n                    //  1.0); // A\r\n}\r\n\r\n`;\r\n\r\nclass CSVLayer {\r\n  constructor(data, options) {\r\n    this.data = parse(data, { columns: true }); //.slice(0, 1000); //shuffleArray(parse(data)).slice(0, 5000);\r\n    console.log('points:', this.data.length);\r\n    this.options = { ...options, columns: true };\r\n\r\n    this.mercator = new Mercator();\r\n  }\r\n\r\n  init(group) {\r\n    this.group = new Group();\r\n    this.group.name = 'CSVLayer.group';\r\n    group.add(this.group);\r\n\r\n    this.createObjects();\r\n  }\r\n\r\n  destroy() {}\r\n\r\n  createObjects() {\r\n    const colors = [\r\n      0x3de6b1,\r\n      0x22ecf0,\r\n      0x19d1fd,\r\n      0x14b1fd,\r\n      0x2c7fdb,\r\n      0x3d52bf,\r\n      0x6539b3,\r\n      0xa032b2,\r\n      0xd124a9,\r\n      0xfb139c,\r\n      0xfd4dab,\r\n      0xfea7d4,\r\n      0xffffff\r\n    ].map(\r\n      color => new Color(color)\r\n      /*new LineBasicMaterial({\r\n          color,\r\n          opacity: 0.5,\r\n          blending: AdditiveBlending,\r\n          transparent: true\r\n        })*/\r\n    );\r\n\r\n    const scale = scaleThreshold()\r\n      .domain([3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39])\r\n      .range(colors);\r\n\r\n    const geometry = new BufferGeometry();\r\n    const vertices = [];\r\n    const degree = new Float32Array(this.data.length * 2);\r\n    const displacement = new Float32Array(this.data.length * 2);\r\n    const v3Colors = []; //new Float32Array( this.data.length * 2 );\r\n\r\n    this.data.forEach((point, idx) => {\r\n      const { x, y } = this.mercator.fromGeo(\r\n        parseFloat(point.X),\r\n        parseFloat(point.Y)\r\n      );\r\n      const z = point.value;\r\n\r\n      vertices.push(x, 0, y);\r\n      vertices.push(x, z, y);\r\n\r\n      const d = (idx / this.data.length) * 2 * PI;\r\n      degree[idx * 2] = d;\r\n      degree[idx * 2 + 1] = d;\r\n\r\n      const r = Math.random() * 2 - 1;\r\n      displacement[idx * 2] = r;\r\n      displacement[idx * 2 + 1] = r;\r\n\r\n      const color = scale(z);\r\n      const v3 = new Vector3(color.r * 255, color.g * 255, color.b * 255);\r\n\r\n      v3Colors.push(color.r, color.g, color.b);\r\n      v3Colors.push(color.r, color.g, color.b);\r\n    });\r\n\r\n    geometry.addAttribute('position', new Float32BufferAttribute(vertices, 3));\r\n    geometry.addAttribute('a_degree', new BufferAttribute(degree, 1));\r\n    geometry.addAttribute(\r\n      'a_displacement',\r\n      new BufferAttribute(displacement, 1)\r\n    );\r\n    geometry.addAttribute('a_color', new Float32BufferAttribute(v3Colors, 3));\r\n\r\n    const uniforms = {\r\n      u_hexSize: {\r\n        type: 'f', // a float\r\n        value: 1\r\n      },\r\n      u_angle: {\r\n        type: 'f', // a float\r\n        value: 0\r\n      }\r\n    };\r\n\r\n    const material = new ShaderMaterial({\r\n      uniforms,\r\n      vertexShader,\r\n      fragmentShader\r\n      // blending: AdditiveBlending\r\n    });\r\n\r\n    const mesh = new LineSegments(geometry, material);\r\n    this.group.add(mesh);\r\n\r\n    const mouseMove$ = fromEvent(document, 'mousemove');\r\n\r\n    merge(\r\n      SceneService.animatePause$.pipe(\r\n        switchMap(paused => (paused ? empty() : mouseMove$)),\r\n        map(ev => {\r\n          const x =\r\n            (ev.pageX - window.scrollX - window.innerWidth / 2) /\r\n            (window.innerWidth / 2);\r\n          const y =\r\n            (ev.pageY - window.scrollY - window.innerHeight / 2) /\r\n            (window.innerHeight / 2);\r\n\r\n          return Math.max(x, y); // Math.hypot(p.x, p.y) / Math.SQRT2;\r\n        })\r\n      ),\r\n      SceneService.radius$.pipe(\r\n        filter(d => !d.inner),\r\n        map(d => d.value)\r\n      )\r\n    ).subscribe(x => {\r\n      uniforms.u_hexSize.value = x * 10;\r\n\r\n      SceneService.radius$.next({value: x * 100, inner: true});\r\n    });\r\n\r\n    const o = {\r\n      u_angle: uniforms.u_angle.value\r\n    };\r\n\r\n    const tl = new TimelineMax({\r\n      paused: true,\r\n      repeat: -1,\r\n      repeatDelay: 2,\r\n      yoyo: true,\r\n      onUpdate: t => {\r\n        // console.log(tl.totalProgress());\r\n        SceneService.animateProgress$.next({\r\n          value: tl.progress() * 100,\r\n          inner: true\r\n        });\r\n        uniforms.u_angle.value = o.u_angle;\r\n      }\r\n    }).to(o, 6, {\r\n      u_angle: 1,\r\n      ease: Power2.easeInOut\r\n    });\r\n    console.timeEnd('createObjects');\r\n\r\n    SceneService.animatePause$.subscribe(paused => {\r\n      paused ? tl.pause() : tl.resume();\r\n    });\r\n\r\n    SceneService.animateProgress$.pipe(filter(d => !d.inner)).subscribe(d => {\r\n      tl.progress(d.value);\r\n    });\r\n  }\r\n\r\n  update() {}\r\n}\r\n\r\nexport default CSVLayer;\r\n\r\nfunction shuffleArray(a) {\r\n  for (let i = a.length - 1; i > 0; i--) {\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    [a[i], a[j]] = [a[j], a[i]];\r\n  }\r\n  return a;\r\n}\r\n","import {\r\n  AdditiveBlending,\r\n  Group,\r\n  Geometry,\r\n  LineBasicMaterial,\r\n  LineSegments,\r\n  ExtrudeGeometry,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  // MeshNormalMaterial,\r\n  // OctahedronGeometry,\r\n  Shape,\r\n  DoubleSide,\r\n  Vector3\r\n} from 'three';\r\nimport { featureEach } from '@turf/meta';\r\nimport { centroid, getCoords, getType, polygon, getCoord } from '@turf/turf';\r\nimport { TweenLite, Power2, Bounce, Elastic, SteppedEase } from 'gsap/all';\r\nimport { scaleLinear, scaleThreshold, scaleQuantize } from 'd3-scale';\r\n\r\nimport { pairs } from 'd3';\r\nimport Mercator from './Mercator.class';\r\nimport { PI_HALF } from '../config';\r\n    \r\nconst colors = [\r\n  0x3de6b1,\r\n  0x22ecf0,\r\n  0x19d1fd,\r\n  0x14b1fd,\r\n  0x2c7fdb,\r\n  0x3d52bf,\r\n  0x6539b3,\r\n  0xa032b2,\r\n  0xd124a9,\r\n  0xfb139c,\r\n  0xfd4dab,\r\n  0xfea7d4,\r\n  0xffffff\r\n].map(color => new MeshBasicMaterial({\r\n  color,\r\n  side: DoubleSide\r\n  // opacity: 0.5,\r\n  // blending: AdditiveBlending,\r\n  // transparent: true\r\n}));\r\n\r\nconst scale = scaleThreshold()\r\n.domain([3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39])\r\n.range(colors);\r\n\r\n\r\nclass GeoJsonLayer {\r\n  constructor(geojson, options) {\r\n    this.geojson = geojson;\r\n    this.options = { ...options };\r\n\r\n    this.mercator = new Mercator();\r\n  }\r\n\r\n  init(group) {\r\n    this.group = new Group();\r\n    this.group.name = 'GeoJsonLayer.group';\r\n    group.add(this.group);\r\n\r\n    featureEach(this.geojson, (feature, id) => this.createMesh(feature, id));\r\n  }\r\n\r\n  destroy() {}\r\n\r\n  createMesh(feature, id) {\r\n    const geometry = new Geometry();\r\n\r\n    const polygons = [];\r\n    if (getType(feature) === 'MultiPolygon') {\r\n      getCoords(feature).forEach(coords => polygons.push(coords));\r\n    } else if (getType(feature) === 'Polygon') {\r\n      polygons.push(getCoords(feature));\r\n    } else {\r\n      polygons.push(getCoords(feature));\r\n      // throw new Error('Type is ' + getType(feature));\r\n    }\r\n\r\n    // const material = new MeshBasicMaterial();\r\n    const startY = 12;\r\n    const gap = 4;\r\n\r\n\r\n    polygons.forEach((coords, polygonId) => {\r\n      const polyCentroid = getCoord(centroid(polygon(coords)));\r\n      const centerPoint = this.mercator.fromGeo(polyCentroid[0], polyCentroid[1]);\r\n\r\n      if (this.options.fill) {\r\n        const shape = new Shape();\r\n\r\n        const points = coords[0].map(c => this.mercator.fromGeo(c[0], c[1]));\r\n\r\n        const startPoint = points.shift();\r\n        shape.moveTo(startPoint.x - centerPoint.x, startPoint.y - centerPoint.y);\r\n        points.forEach(p => {\r\n          shape.lineTo(p.x - centerPoint.x, p.y - centerPoint.y)\r\n        });\r\n        \r\n\r\n        const geometry = new ExtrudeGeometry(shape, {\r\n          amount: -5,//-feature.properties.value,\r\n          bevelEnabled: true,\r\n          bevelSegments: 2,\r\n          steps: 2,\r\n          bevelSize: 1,\r\n          bevelThickness: 1\r\n        });\r\n\r\n        const mesh = new Mesh(\r\n          geometry,\r\n          scale(feature.properties.value)\r\n        );\r\n\r\n        mesh.position.set(centerPoint.x, 0, centerPoint.y);\r\n        mesh.rotation.x = PI_HALF;\r\n\r\n        this.group.add(mesh);\r\n      } else {\r\n        \r\n        const points = coords[0].map(c => {\r\n          const p = this.mercator.fromGeo(c[0], c[1]);\r\n          return new Vector3(p.x - centerPoint.x, 0, p.y - centerPoint.y);\r\n        });\r\n\r\n        pairs(points, (a, b) => geometry.vertices.push(a, b));\r\n\r\n          const material = new LineBasicMaterial({\r\n            color: this.options.color || 0x67fefe,\r\n            opacity: 0,\r\n            transparent: true\r\n          });\r\n\r\n          const mesh = new LineSegments(geometry, material);\r\n          mesh.scale.set(0.001, 1, 0.001);\r\n          mesh.position.set(centerPoint.x, this.options.pos || 5, centerPoint.y);\r\n\r\n          const o = {\r\n            _scale: 0.001\r\n          }\r\n\r\n          TweenLite.to(o, 1.0, {\r\n            _scale: 1,\r\n            delay: 1 + id * 0.03,\r\n            // ease: Bounce.easeOut,\r\n            // ease:  Elastic.easeOut.config(1, 0.3),\r\n            ease:  SteppedEase.config(10),\r\n            onUpdate: t => {\r\n              // mesh.scale.set(o._scale, o._scale, o._scale);\r\n              mesh.scale.set(o._scale, 1, o._scale);\r\n              mesh.material.opacity = o._scale * (this.options.opacity || 0.3);\r\n              // mesh.rotation.y = ((1 - o._scale) * PI_HALF);\r\n              // mesh.position.setY(50);\r\n            }\r\n          });\r\n\r\n          this.group.add(mesh);\r\n\r\n          if (feature.properties['NROSIEDLA'] === 1) {\r\n            const meshDuplicate = mesh.clone();\r\n            meshDuplicate.material.color.setHex(0x3498db);\r\n            meshDuplicate.scale.set(0.99, 1, 0.99);\r\n            this.group.add(meshDuplicate);\r\n          }\r\n      }\r\n    });\r\n  }\r\n\r\n  update() {}\r\n}\r\n\r\nexport default GeoJsonLayer;\r\n","import React, { Component } from 'react';\r\nimport axios from 'axios';\r\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\r\nimport parse from 'csv-parse/lib/sync';\r\n\r\nimport styles from './SceneContainer.module.css';\r\nimport SceneManager from '../../classes/SceneManager.class';\r\nimport TileGridLayer from '../../classes/TileGridLayer.class';\r\nimport {\r\n  BBOX_WROCLAW,\r\n  TILE_URL_LOCAL,\r\n  TILE_URL_CARTO_DARK\r\n  // TILE_URL_OSM,\r\n  // TILE_URL_ESRI,\r\n  // TILE_URL_ORTO_2018\r\n} from '../../config';\r\nimport CSVLayer from '../../classes/CSVLayer.class';\r\nimport SurfaceLayer from '../../classes/SurfaceLayer.class';\r\nimport GeoJsonLayer from '../../classes/GeoJsonLayer.class';\r\nimport ImageLayer from '../../classes/ImageLayer.class';\r\nimport ShaderLayer from '../../classes/ShaderLayer.class';\r\n\r\nimport SceneService from '../../classes/SceneService';\r\n\r\nexport class SceneContainer extends Component {\r\n  canvasRef = React.createRef();\r\n\r\n  componentDidMount() {\r\n    this.sceneManager = new SceneManager(this.canvasRef.current);\r\n\r\n    this.initLayers();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.sceneManager.destroy();\r\n  }\r\n\r\n  initLayers() {\r\n    // const shaderLayer = new ShaderLayer();\r\n    // this.sceneManager.addLayer(shaderLayer);\r\n\r\n    // const tilelayer = new TileGridLayer(BBOX_WROCLAW, TILE_URL_CARTO_DARK, {\r\n    //   offset: -10,\r\n    //   tileOffset: 2\r\n    // });\r\n    // this.sceneManager.addLayer(tilelayer);\r\n\r\n    // const ortoLayer = new ImageLayer(\r\n    //   // `${process.env.PUBLIC_URL}/assets/heatmap_test.png`,\r\n    //   `${process.env.PUBLIC_URL}/assets/orto200dpi-min.png`,\r\n    //   [16.8073368072509766,51.0426673889160156,17.1762199401855469,51.2100677490234375],\r\n    //   {\r\n    //     alphaMap: `${process.env.PUBLIC_URL}/assets/wroclaw_boundary_alpha_map.png`,\r\n    //     offsetY: 1,\r\n    //     opacity: 0.2\r\n    //   }\r\n    // );\r\n    // this.sceneManager.addLayer(ortoLayer);\r\n\r\n    // const heatmapLayer = new ImageLayer(\r\n    //   `${process.env.PUBLIC_URL}/assets/heatmap_test.png`,\r\n    //   [\r\n    //     16.8073368072509766,\r\n    //     51.0426673889160156,\r\n    //     17.1762199401855469,\r\n    //     51.2100677490234375\r\n    //   ],\r\n    //   {\r\n    //     alphaMap: `${\r\n    //       process.env.PUBLIC_URL\r\n    //     }/assets/wroclaw_boundary_alpha_map.png`,\r\n    //     offsetY: 0,\r\n    //     opacity: 0.75\r\n    //   }\r\n    // );\r\n    // this.sceneManager.addLayer(heatmapLayer);\r\n\r\n    // const tilelayer2 = new TileGridLayer(BBOX_WROCLAW, TILE_URL_LOCAL, {offset: -2});\r\n    // this.sceneManager.addLayer(tilelayer2);\r\n\r\n    axios\r\n      .get(\r\n        `${process.env.PUBLIC_URL}/assets/wroclaw-osiedla-simplified.geo.json`\r\n        // `${process.env.PUBLIC_URL}/assets/roads_secondary.geo.json`\r\n      )\r\n      .then(response => {\r\n        const boundslayer = new GeoJsonLayer(response.data);\r\n        this.sceneManager.addLayer(boundslayer);\r\n      });\r\n\r\n    // axios\r\n    //   .get(\r\n    //     `${process.env.PUBLIC_URL}/assets/grid_200m_hex_grid.geojson`\r\n    //     // `${process.env.PUBLIC_URL}/assets/roads_secondary.geo.json`\r\n    //   )\r\n    //   .then(response => {\r\n    //     const boundslayer = new GeoJsonLayer(response.data, {\r\n    //       fill: true\r\n    //     });\r\n    //     this.sceneManager.addLayer(boundslayer);\r\n    //   });\r\n\r\n    axios\r\n      // .get(`${process.env.PUBLIC_URL}/assets/grid_100m_hex.csv`)\r\n      // .get(`${process.env.PUBLIC_URL}/assets/grid_100m_hex.csv`)\r\n      .get(`${process.env.PUBLIC_URL}/assets/centroidy.csv`)\r\n      .then(response => {\r\n        const centroidsLayer = new CSVLayer(response.data);\r\n        this.sceneManager.addLayer(centroidsLayer);\r\n      });\r\n\r\n    // axios\r\n    //   .get(`${process.env.PUBLIC_URL}/assets/river_clean.geo.json`)\r\n    //   .then(response => {\r\n    //     const riverLayer = new GeoJsonLayer(response.data, {\r\n    //       color: 0x3498db,\r\n    //       fill: true\r\n    //     });\r\n    //     this.sceneManager.addLayer(riverLayer);\r\n    //   });\r\n\r\n    // axios// .get(`${process.env.PUBLIC_URL}/assets/test_grid_5km.csv`)\r\n    //   .get(`${process.env.PUBLIC_URL}/assets/grid_500m_square.csv`)\r\n    //   .then(response => {\r\n    //     const surfaceLayer = new SurfaceLayer(\r\n    //       parse(response.data, { columns: true }),\r\n    //       {\r\n    //         rows: 77,\r\n    //         cols: 58\r\n    //       }\r\n    //     );\r\n    //     this.sceneManager.addLayer(surfaceLayer);\r\n    //   });\r\n\r\n    // SceneService.sceneSwitch$.subscribe(state => {\r\n    //   if (state.layer === 'heatmap') {\r\n    //     this.sceneManager.setLayerVisibility(heatmapLayer, state.visible);\r\n    //   }\r\n    // });\r\n\r\n    // SceneService.sceneProgress$\r\n    //   .pipe(\r\n    //     distinctUntilChanged(),\r\n    //     debounceTime(10)\r\n    //   )\r\n    //   .subscribe(state => {\r\n    //     if (state.layer === 'heatmap') {\r\n    //       this.sceneManager.setLayerOpacity(\r\n    //         heatmapLayer,\r\n    //         state.progress,\r\n    //         state.direction\r\n    //       );\r\n    //     }\r\n    //   });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={styles.wrapper}>\r\n        <canvas ref={this.canvasRef} className={styles.canvas} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport anime from 'animejs';\r\n\r\nimport styles from './Frame.module.css';\r\n\r\nconst paths = {\r\n  step0: (frameSize, width, height) =>\r\n    `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M 0,0 ${width},0 ${width},${height} 0,${height} Z`,\r\n  step1: (frameSize, width, height) =>\r\n    `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M ${frameSize},${frameSize} ${width},0 ${width},${height} 0,${height} Z`,\r\n  step2: (frameSize, width, height) =>\r\n    `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M ${frameSize},${frameSize} ${width -\r\n      frameSize},${frameSize} ${width},${height} 0,${height} Z`,\r\n  step3: (frameSize, width, height) =>\r\n    `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M ${frameSize},${frameSize} ${width -\r\n      frameSize},${frameSize} ${width - frameSize},${height -\r\n      frameSize} 0,${height} Z`,\r\n  step4: (frameSize, width, height) =>\r\n    `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M ${frameSize},${frameSize} ${width -\r\n      frameSize},${frameSize} ${width - frameSize},${height -\r\n      frameSize} ${frameSize},${height - frameSize} Z`\r\n};\r\n\r\n// const pathNew = (width, height) => {\r\n//   const point1 = {x: width/4-50, y: height/4+50};\r\n//   const point2 = {x: width/4+50, y: height/4-50};\r\n//   const point3 = {x: width-point2.x, y: height-point2.y};\r\n//   const point4 = {x: width-point1.x, y: height-point1.y};\r\n\r\n//   return `M 0,0 0,${height} ${width},${height} ${width},0 0,0 Z M ${point1.x},${point1.y} ${point2.x},${point2.y} ${point4.x},${point4.y} ${point3.x},${point3.y} Z`;\r\n// }\r\n\r\nexport class Frame extends Component {\r\n  state = {\r\n    rect: {\r\n      width: 0,\r\n      height: 0\r\n    }\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.svg = React.createRef();\r\n    this.path = React.createRef();\r\n    this.frameSize = 45;\r\n  }\r\n\r\n  componentDidMount() {\r\n    const rect = this.svg.current.getBoundingClientRect();\r\n    this.setState({ rect });\r\n\r\n    const animateShapeOutTimeline = anime.timeline({\r\n      duration: 300,\r\n      easing: 'easeInQuad',\r\n      direction: 'alternate',\r\n      loop: true\r\n    });\r\n\r\n    const path = this.path;\r\n\r\n    animateShapeOutTimeline\r\n      .add({\r\n        targets: path.current,\r\n        d: paths.step1(this.frameSize, rect.width, rect.height)\r\n      })\r\n      .add({\r\n        targets: path.current,\r\n        d: paths.step2(this.frameSize, rect.width, rect.height)\r\n      })\r\n      .add({\r\n        targets: path.current,\r\n        d: paths.step3(this.frameSize, rect.width, rect.height)\r\n      })\r\n      .add({\r\n        targets: path.current,\r\n        d: paths.step4(this.frameSize, rect.width, rect.height)\r\n      });\r\n\r\n    console.log(rect);\r\n    console.log(paths.step2(this.frameSize, rect.width, rect.height));\r\n    // console.log(this.frameSize)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <svg\r\n        className={styles.Frame}\r\n        ref={this.svg}\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        vievbox={`0 0 ${this.state.rect.width} ${this.state.rect.height}`}\r\n      >\r\n        <defs>\r\n          <linearGradient id=\"gradient1\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\r\n            <stop offset=\"0%\" stopColor=\"#ED4264\" />\r\n            <stop offset=\"100%\" stopColor=\"#FFEDBC\" />\r\n          </linearGradient>\r\n        </defs>\r\n        <path\r\n          ref={this.path}\r\n          d={paths.step0(\r\n            this.frameSize,\r\n            this.state.rect.width,\r\n            this.state.rect.height\r\n          )}\r\n          fill=\"url(#gradient1)\"\r\n        />\r\n      </svg>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { isElement } from 'react-is';\r\nimport { fromEvent } from 'rxjs';\r\n\r\nconst defaultProps = {\r\n  topOffset: '0px',\r\n  bottomOffset: '0px',\r\n  horizontalll: false,\r\n  onProgress() {}\r\n};\r\n\r\nconst POSITION = {\r\n  ABOVE: 'above',\r\n  BELOW: 'below',\r\n  INSIDE: 'inside',\r\n  INVISIBLE: 'invisible'\r\n};\r\n\r\nclass Scrollr extends Component {\r\n  state = {\r\n    progress: 0\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.refEl = React.createRef();\r\n    this.scrollableParent = null;\r\n    this.subscriptions = [];\r\n\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n    this.renderArgs = {};\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.subscriptions.forEach(subscription => subscription.unsubscribe());\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.scrollableParent = this.getScrollableParent();\r\n\r\n    this.scroll$ = fromEvent(this.scrollableParent, 'scroll', {\r\n      passive: true\r\n    });\r\n    this.subscriptions.push(this.scroll$);\r\n\r\n    this.scroll$.subscribe(this.handleScroll);\r\n  }\r\n\r\n  handleScroll(event) {\r\n    // log(event);\r\n\r\n    const bounds = this.getBounds();\r\n    \r\n    const previousPosition = this.position;\r\n    const currentPosition = this.getPosition(bounds);\r\n    this.position = currentPosition;\r\n\r\n    // log(JSON.stringify(bounds, false, 2));\r\n    // log({ currentPosition, previousPosition });\r\n\r\n\r\n    const cbArgs = {\r\n      position: currentPosition   \r\n    }\r\n\r\n    if (bounds.topOffsetPx === 0) {\r\n      // 100% in the middle of ancestor;\r\n      const pointEnd = (bounds.viewportBottom - bounds.viewportTop) / 2;\r\n      const pTop = 1 - Math.max(Math.min((bounds.waypointTop - pointEnd) / pointEnd, 1), 0);\r\n      const pBottom = 1 - Math.max(Math.min(-(bounds.waypointBottom - pointEnd) / pointEnd, 1), 0);\r\n\r\n      const direction = pTop > pBottom ? -1 : 1;\r\n      log('direction:', direction);\r\n      cbArgs.direction = direction;\r\n\r\n      if (currentPosition === POSITION.INSIDE) {\r\n        cbArgs.progress = Math.min(pTop, pBottom);\r\n        log(Math.min(pTop, pBottom));\r\n        log(pTop, pBottom);\r\n        this.props.onProgress(cbArgs);\r\n        this.setState(cbArgs);\r\n      } else {\r\n        cbArgs.progress = 0;\r\n        this.setState(cbArgs);\r\n      }\r\n\r\n    } else {\r\n      // calc 0 - 100 %\r\n    }\r\n\r\n    if (previousPosition === currentPosition) {\r\n      return;\r\n    }\r\n\r\n    if (currentPosition === POSITION.INSIDE) {\r\n      this.props.onEnter();\r\n    } else if (previousPosition === POSITION.INSIDE) {\r\n      this.props.onLeave();\r\n    }\r\n\r\n\r\n  }\r\n\r\n  getPosition(bounds) {\r\n    if (bounds.viewportBottom - bounds.viewportTop === 0) {\r\n      return POSITION.INVISIBLE;\r\n    }\r\n  \r\n    // top is within the viewport\r\n    if (bounds.viewportTop <= bounds.waypointTop &&\r\n        bounds.waypointTop <= bounds.viewportBottom) {\r\n      return POSITION.INSIDE;\r\n    }\r\n  \r\n    // bottom is within the viewport\r\n    if (bounds.viewportTop <= bounds.waypointBottom &&\r\n        bounds.waypointBottom <= bounds.viewportBottom) {\r\n      return POSITION.INSIDE;\r\n    }\r\n  \r\n    // top is above the viewport and bottom is below the viewport\r\n    if (bounds.waypointTop <= bounds.viewportTop &&\r\n        bounds.viewportBottom <= bounds.waypointBottom) {\r\n      return POSITION.INSIDE;\r\n    }\r\n  \r\n    if (bounds.viewportBottom < bounds.waypointTop) {\r\n      return POSITION.BELOW;\r\n    }\r\n  \r\n    if (bounds.waypointTop < bounds.viewportTop) {\r\n      return POSITION.ABOVE;\r\n    }\r\n  \r\n    return POSITION.INVISIBLE;\r\n  }\r\n\r\n  getBounds() {\r\n    const parentElement = this.refEl.current;\r\n    const horizontal = this.props.horizontal;\r\n    const { left, top, right, bottom } = parentElement.getBoundingClientRect();\r\n\r\n    const waypointTop = horizontal ? left : top;\r\n    const waypointBottom = horizontal ? right : bottom;\r\n\r\n    let contextHeight;\r\n    let contextScrollTop;\r\n\r\n    if (this.scrollableParent === window) {\r\n      contextHeight = horizontal ? window.innerWidth : window.innerHeight;\r\n      contextScrollTop = 0;\r\n    } else {\r\n      contextHeight = horizontal\r\n        ? parentElement.offsetWidth\r\n        : parentElement.offsetHeight;\r\n      contextScrollTop = horizontal\r\n        ? parentElement.getBoundingClientRect().left\r\n        : parentElement.getBoundingClientRect().top;\r\n    }\r\n\r\n    const { bottomOffset, topOffset } = this.props;\r\n    const topOffsetPx = computeOffsetPixels(topOffset, contextHeight);\r\n    const bottomOffsetPx = computeOffsetPixels(bottomOffset, contextHeight);\r\n    const contextBottom = contextScrollTop + contextHeight;\r\n\r\n    return {\r\n      contextScrollTop,\r\n      topOffsetPx,\r\n      contextHeight,\r\n      waypointTop,\r\n      waypointBottom,\r\n      viewportTop: contextScrollTop + topOffsetPx,\r\n      viewportBottom: contextBottom - bottomOffsetPx,\r\n    }\r\n  }\r\n\r\n  getScrollableParent() {\r\n    const { horizontal } = this.props;\r\n\r\n    let node = this.refEl.current;\r\n\r\n    while (node.parentNode) {\r\n      node = node.parentNode;\r\n\r\n      if (node === document.body) {\r\n        return window;\r\n      }\r\n\r\n      const style = window.getComputedStyle(node);\r\n      const overflowDirec = horizontal\r\n        ? style.getPropertyValue('overflow-x')\r\n        : style.getPropertyValue('overflow-y');\r\n      const overflow = overflowDirec || style.getPropertyValue('overflow');\r\n\r\n      if (overflow === 'auto' || overflow === 'scroll') {\r\n        return node;\r\n      }\r\n    }\r\n\r\n    return window;\r\n  }\r\n\r\n  render() {\r\n    const { render, children } = this.props;\r\n    log('render typeof:', typeof render);\r\n\r\n    if (render && typeof render === 'function') {\r\n      log('function', this.state.cbArgs);\r\n      return React.cloneElement(render(this.state), { ref: this.refEl });\r\n    } else if (isElement(children)) {\r\n      log('children el');\r\n      return children;\r\n    }\r\n\r\n    return <div />;\r\n  }\r\n}\r\n\r\nexport default Scrollr;\r\nScrollr.defaultProps = defaultProps;\r\nScrollr.displayName = 'Scrollr';\r\n\r\nfunction log() {\r\n  return () => {};\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    return console.log.apply(null, arguments); // eslint-disable-line no-console\r\n  }\r\n}\r\n\r\nfunction computeOffsetPixels(offset, contextHeight) {\r\n  const pixelOffset = parseOffsetAsPixels(offset);\r\n\r\n  if (typeof pixelOffset === 'number') {\r\n    return pixelOffset;\r\n  }\r\n\r\n  const percentOffset = parseOffsetAsPercentage(offset);\r\n  if (typeof percentOffset === 'number') {\r\n    return percentOffset * contextHeight;\r\n  }\r\n}\r\n\r\nfunction parseOffsetAsPixels(str) {\r\n  if (!isNaN(parseFloat(str)) && isFinite(str)) {\r\n    return parseFloat(str);\r\n  } else if (str.slice(-2) === 'px') {\r\n    return parseFloat(str.slice(0, -2));\r\n  }\r\n}\r\n\r\nfunction parseOffsetAsPercentage(str) {\r\n  if (str.slice(-1) === '%') {\r\n    return parseFloat(str.slice(0, -1)) / 100;\r\n  }\r\n}","import React, { Component } from 'react';\r\nimport { fromEvent, Subject } from 'rxjs';\r\nimport {\r\n  map,\r\n  distinctUntilChanged,\r\n  bufferCount,\r\n  pairwise\r\n} from 'rxjs/operators';\r\n\r\nimport style from './CursorParallax.module.css';\r\n\r\nclass CursorParallax extends Component {\r\n  state = {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.initEvents = this.initEvents.bind(this);\r\n    this.unsetEvents = this.unsetEvents.bind(this);\r\n    this.loop = this.loop.bind(this);\r\n\r\n    this.cursorRef = React.createRef();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initEvents();\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.unsetEvents();\r\n  }\r\n\r\n  initEvents() {\r\n    this.mouseMove$ = fromEvent(window, 'mousemove', { passive: true });\r\n\r\n    this.mouseMove$.subscribe(({ clientX, clientY }) => {\r\n      this.target = { x: clientX, y: clientY };\r\n    });\r\n\r\n    this.cursorVisible = new Subject();\r\n\r\n    this.cursorVisible\r\n      .pipe(\r\n        map(val => {\r\n          return val < 25;\r\n        }),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe(visible => {\r\n        this.cursorRef.current.classList.toggle(style.active, !visible);\r\n      });\r\n\r\n    this.raf = requestAnimationFrame(this.loop);\r\n  }\r\n\r\n  loop() {\r\n    if (this.target) {\r\n      const computed = this.cursorRef.current.getBoundingClientRect();\r\n      const v2 = {\r\n        x: computed.x - this.target.x,\r\n        y: computed.y - this.target.y\r\n      };\r\n\r\n      const a = [computed.x, computed.y];\r\n      const b = [\r\n        this.target.x - computed.width / 2,\r\n        this.target.y - computed.height / 2\r\n      ];\r\n\r\n      const diff = Math.hypot(a[0] - b[0], a[1] - b[1]);\r\n      const angle = Math.atan2(b[1] - a[1], b[0] - a[0]) * 180 / Math.PI;;\r\n\r\n      const pos = lerp(a, b, 2);\r\n\r\n      this.cursorVisible.next(diff);\r\n\r\n      this.cursorRef.current.style.transform = `translate(${pos[0]}px, ${\r\n        pos[1]\r\n      }px)`;\r\n    }\r\n\r\n    requestAnimationFrame(this.loop);\r\n  }\r\n\r\n  unsetEvents() {}\r\n\r\n  render() {\r\n    return (\r\n      <div className={style.wrapper}>\r\n        <div className={style.cursor} ref={this.cursorRef} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CursorParallax;\r\n\r\nfunction lerp(a, b, t) {\r\n  var len = a.length;\r\n  if (b.length != len) return;\r\n\r\n  var x = [];\r\n  for (var i = 0; i < len; i++) x.push(a[i] + t * (b[i] - a[i]));\r\n  return x;\r\n}\r\n","import React, { Component } from 'react';\n\n// import Slider from 'rc-slider';\n// import 'rc-slider/assets/index.css';\n\nimport { Button, Slider, Switch } from 'antd';\n\nimport './App.css';\nimport { SceneContainer } from './components/SceneContainer/SceneContainer';\nimport { Frame } from './components/Frame/Frame';\n// import Waypoint from './components/Waypoint';\nimport Scrollr from './components/Scrollr';\nimport CursorParallax from './components/CursorParallax';\nimport SceneService from './classes/SceneService';\n\nclass App extends Component {\n  state = {\n    enabledScene: true,\n    enabledFrame: false,\n    enabledAnimate: false,\n    enabledLerp: true,\n    progress: 0,\n    radius: 0\n  };\n\n  constructor() {\n    super();\n\n    this.toggle = this.toggle.bind(this);\n\n    this.handleWaypointEnter = this.handleWaypointEnter.bind(this);\n    this.handleWaypointLeave = this.handleWaypointLeave.bind(this);\n    this.handleWaypointProgress = this.handleWaypointProgress.bind(this);\n    this.pauseResume = this.pauseResume.bind(this);\n    this.animateSetProgress = this.animateSetProgress.bind(this);\n    this.animateSetRadius = this.animateSetRadius.bind(this);\n  }\n\n  componentDidMount() {\n    SceneService.animateProgress$.subscribe(d => {\n      this.setState({ progress: d.value });\n    });\n\n    SceneService.radius$.subscribe(d => {\n      this.setState({ radius: d.value });\n    });\n  }\n\n  toggle(propname) {\n    this.setState(state => {\n      if (propname === 'enabledLerp') {\n        SceneService.sceneLerp$.next(!state[propname]);\n      }\n\n      return {[propname]: !state[propname]};\n    });\n  }\n\n  pauseResume() {\n    SceneService.animatePause$.next(!this.state.enabledAnimate);\n    this.setState(state => ({ enabledAnimate: !state.enabledAnimate }));\n  }\n\n  animateSetProgress(x) {\n    SceneService.animateProgress$.next({ value: x / 100, inner: false });\n    this.setState({ progress: x });\n  }\n\n  animateSetRadius(x) {\n    x = Math.max(x, 0.1);\n    SceneService.radius$.next({ value: x / 100, inner: false });\n    this.setState({ radius: x });\n  }\n\n  handleWaypointEnter() {\n    console.log('enter');\n    SceneService.sceneSwitch$.next({ layer: 'heatmap', visible: true });\n  }\n\n  handleWaypointLeave() {\n    console.log('leave');\n    SceneService.sceneSwitch$.next({ layer: 'heatmap', visible: false });\n  }\n\n  handleWaypointProgress({ progress, direction }) {\n    SceneService.sceneProgress$.next({ layer: 'heatmap', progress, direction });\n  }\n\n  onPositionChange(pos) {\n    // console.log('onPositionChange', pos);\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <div className=\"debug\">\n          <Button onClick={() => this.toggle('enabledFrame')}>\n            frame on/off\n          </Button>\n          <Button onClick={() => this.toggle('enabledScene')}>\n            scene on/off\n          </Button>\n          <Button onClick={() => this.pauseResume()} type=\"primary\">\n            pause / resume\n          </Button>\n        </div>\n        <div className=\"debug-controls\">\n          <div className=\"control\">\n            {/* <span>state:</span> */}\n            <Switch\n              defaultChecked\n              checkedChildren=\"animating\" unCheckedChildren=\"paused\"\n              onChange={this.pauseResume}\n              checked={!this.state.enabledAnimate}\n            />\n            <Switch\n              defaultChecked\n              checkedChildren=\"lerp\" unCheckedChildren=\"control\"\n              onChange={() => this.toggle('enabledLerp')}\n              checked={this.state.enabledLerp}\n            />\n          </div>\n          <div className=\"control\">\n            <span>animation:</span>\n            <Slider\n              step={0.1}\n              onChange={this.animateSetProgress}\n              value={this.state.progress}\n            />\n          </div>\n          <div className=\"control\">\n            <span>grid radius:</span>\n            <Slider\n              step={0.1}\n              onChange={this.animateSetRadius}\n              value={this.state.radius}\n            />\n          </div>\n        </div>\n        {this.state.enabledScene && <SceneContainer />}\n        {/* {this.state.enabledFrame && <Frame />}\n        <CursorParallax />\n        <main>\n          <section className=\"map\" />\n          <Scrollr\n            // topOffset='30%'\n            // bottomOffset='30%'\n            // debug={true}\n            onProgress={this.handleWaypointProgress}\n            onEnter={this.handleWaypointEnter}\n            onLeave={this.handleWaypointLeave}\n            onPositionChange={this.onPositionChange}\n            render={({ progress, position }) => (\n              <section className={position === 'inside' ? 'active' : ''}>\n                <div className={`page`}>\n                  <h1>\n                    <span>Solutions </span>\n                  </h1>\n                  <p>\n                    <span>\n                      Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n                      Etiam tempor posuere risus, quis interdum ligula\n                      ullamcorper vel. Duis non nisl id ex imperdiet ultricies.\n                      Duis blandit ac arcu vitae pulvinar. Morbi facilisis mi\n                      tempor felis aliquet, volutpat faucibus mauris\n                      pellentesque. Sed non consequat arcu. Phasellus bibendum\n                      nibh massa, et pretium dolor accumsan a. Nulla\n                      pellentesque nibh tellus, a molestie purus finibus nec.\n                    </span>\n                  </p>\n                  <p>\n                    <span>\n                      Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n                      Etiam tempor posuere risus, quis interdum ligula\n                      ullamcorper vel. Duis non nisl id ex imperdiet ultricies.\n                      Duis blandit ac arcu vitae pulvinar. Morbi facilisis mi\n                      tempor felis aliquet, volutpat faucibus mauris\n                      pellentesque. Sed non consequat arcu. Phasellus bibendum\n                      nibh massa, et pretium dolor accumsan a. Nulla\n                      pellentesque nibh tellus, a molestie purus finibus nec.\n                    </span>\n                  </p>\n                </div>\n              </section>\n            )}\n          />\n          <section />\n          <section />\n        </main> */}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport 'antd/dist/antd.css';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}